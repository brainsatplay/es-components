(()=>{var D=Object.defineProperty;var M=(d,e)=>{for(var t in e)D(d,t,{get:e[t],enumerable:!0})};var _={};M(_,{default:()=>q});var E="default";var f={start:"esConnected",stop:"esDisconnected",connected:"esReady",hierarchy:"esDOM",element:"esElement",webcomponents:"esComponents",attributes:"esAttributes",listeners:{value:"esListeners",branch:"esBranch",bind:"esBind",trigger:"esTrigger",format:"esFormat"},trigger:"esTrigger",compose:"esCompose",uri:"esURI",reference:"esReference",childPosition:"esChildPosition",attribute:"__isescomponent",parent:"esParent",component:"esComponent",source:"esSource",path:"__isESComponent",animate:"esAnimate",options:"__esOptions",states:"__esStates",promise:"__esComponentPromise",proxy:"__esProxy",editor:"esCode",flow:"__esManager",original:"esOriginal",resize:"esOnResize"};var C=Symbol("listenerObject"),A=Symbol("toSet"),V=d=>f.listeners.format in d||f.listeners.branch in d||f.listeners.trigger in d||f.listeners.bind in d,L="INITIALIZED",R="REGISTERED",F={},G={},w={},S=Symbol("subscriptionKey"),T=Symbol("configKey"),k=Symbol("toResolveWithKey"),I=class{constructor(e={},t,s){this.original={};this.active={};this.globals={};this.context={};this.rootPath="";this.status="";this.#e=[];this.#s=[];this.getManager=(e="from")=>{let t=e==="to"?this.globals.to:this.globals.from;return this.rootPath.split(this.context.options.keySeparator).forEach(s=>{t[s]||(t[s]={}),t=t[s]}),t[k]??this};this.onStart=e=>{let t=this.#o;t===this?this.status===L?e():this.#s.push(e):t.onStart(e)};this.runEachListener=(e,t)=>{if(!!t)for(let s in e){let i=e[s];if(!i){console.warn("Skipping empty listener:",s);continue}if(i&&typeof i=="object")for(let o in i)t(o,s,i[o]);else typeof s=="string"?t(i,s,s):console.error("Improperly Formatted Listener",s)}};this.register=(e=this.original)=>{this.runEachListener(e,this.add),this.status=R};this.#n=e=>{let t=this.context.monitor.get(e.path,"info");if(typeof t.value=="function"){let s=Array.isArray(e.args)?e.args:[e.args];t.value(...s)}else console.error("Cannot yet trigger values...",e)};this.initialize=e=>{this.status?this.status===R?(this.status=L,this.#e.forEach(this.#n),this.#s.forEach(t=>t()),this.#s=[],this.#e=[]):this.#n(e):this.#e.push(e)};this.start=()=>{this.register(),this.initialize()};this.#i=e=>!e||!this.rootPath||e.includes(this.rootPath)?e:[this.rootPath,e].join(this.context.monitor.options.keySeparator);this.#t=e=>{let t={absolute:{},relative:{}};e=this.#i(e);let s=this.rootPath?e.replace(`${this.rootPath}.`,""):e,i=e.split(this.context.options.keySeparator);return t.absolute.array=[this.context.id,...i],t.relative.array=s.split(this.context.options.keySeparator),this.context.monitor.get(t.relative.array,void 0,this.context.instance)?.hasOwnProperty(f.path)&&(t.absolute.array.push(E),t.relative.array.push(E)),t.absolute.value=t.absolute.array.slice(1).join(this.context.options.keySeparator),t.relative.value=t.relative.array.join(this.context.options.keySeparator),t};this.add=(e,t,s=!0,i)=>{let o=this.#t(e),n=this.#t(t),b=o.absolute.value;i||(i=this.globals.active[b]?.[S]),i||(i=this.context.monitor.on(o.absolute.array,(r,p,P)=>this.activate(r,P),{ref:this.context.instance,path:o.relative.array}));let u={value:s,[C]:!0};[this.active,this.globals.active].forEach(r=>{r[b]||(r[b]={});let p=r[b];p[S]||Object.defineProperty(p,S,{value:i,configurable:!0}),p[n.absolute.value]=u});let a=s[f.listeners.trigger];return a&&this.#o.initialize({path:o.absolute.array,args:a}),this.addToGlobalLog(b),u};this.addToGlobalLog=(e,t="from")=>{let s=this.#i(e),i=t==="to"?this.globals.to:this.globals.from;s.split(this.context.options.keySeparator).forEach(n=>{i[n]||(i[n]={}),i=i[n],i[k]||(i[k]=this)})};this.remove=(e,t)=>{let s=this.#t(e),i=this.#t(t),o=[s.absolute.value,i.absolute.value];[{ref:this.active,path:o},{ref:this.globals.active,path:o,unlisten:!0}].forEach(b=>{let{ref:u,path:y,unlisten:a}=b,r=u[y[0]];if(typeof r=="object"){if(delete r[y[1]],Object.keys(r).length===0){delete u[y[0]];let p=r[S];a&&p&&this.context.monitor.remove(p),delete r[S]}}else delete u[y[0]]})};this.clear=e=>{let t=this.#i(e);Object.keys(this.active).forEach(s=>{Object.keys(this.active[s]).forEach(i=>{(!t||s.slice(0,t.length)===t||i.slice(0,t.length)===t)&&this.remove(s,i)})})};this.has=(e,t=this.active)=>!!t[e];this.get=(e,t=this.active)=>t[e];this.activate=(e,t)=>{[{info:this.get(e,this.globals.active),name}].forEach(i=>{let o=i.info;if(o)if(o[C])this.pass(e,{value:o.value,parent:this.active,key:i.name,subscription:o.subscription,__value:!0},t);else if(typeof o=="object")for(let n in o)this.pass(e,{parent:o,key:n,subscription:o[n].subscription,value:o[n].value},t);else console.error("Improperly Formatted Listener",o)})};this.pass=(e,t,s)=>{let i=this.context.id,o,n,b,u=t?.__value;o=t.parent,n=t.key,b=t.subscription;let y=t.parent[n];t=y.value;let a=y?.[T],r=t,p=typeof t,P=(l,c)=>{let h=this.context.monitor.get(l,"info");if(h.exists){let g=h.value,v={value:typeof g!="function"&&!g?.default?A:g};return c&&(t=v.value,o[n]=v),v}else return{value:void 0}},O=l=>{let c=[i];return c.push(...n.split(this.context.options.keySeparator)),P(c,l)},K=l=>{let c=[i],h=[];return this.rootPath&&h.push(...this.rootPath.split(this.context.options.keySeparator)),h.push(...l.split(this.context.options.keySeparator)),c.push(...h),c};if(typeof t=="boolean")u?console.error(`Cannot use a boolean for ${f.listeners.value}...`):O(!0);else if(p==="string"){let l=K(r);P(l,!0),u&&(o[n]={[r]:o[n]},n=r)}else t&&p==="object"&&V(r)&&("value"in r?u?t=o[n]=r.value:t=o[n].value=r.value:O(!0),r&&r&&(a=r),Object.defineProperty(o[n],T,{value:a}));let j=!0;if(a){let l=f.listeners.value;if(l in a){let c=K(a[l].original??a[l]);if(typeof a[l]=="string"){let h=this.context.monitor.get(c);h?a[l]={value:h,original:a[l]}:t=`because ${c.slice(1).join(this.context.options.keySeparator)} does not point correctly to an existing component.`}else a[l].value.esParent||(t=`because ${a[l].original??i.toString()} has become unparented.`)}else{let c=f.listeners.branch,h=f.listeners.format;if(c in a&&(a[c].find(m=>{let x=[];"condition"in m&&x.push(m.condition(s)),"equals"in m&&x.push(m.equals===s);let v=x.length>0&&x.reduce(($,z)=>$&&z,!0);return v&&"value"in m&&(s=m.value),v})||(j=!1)),h in a)try{s=a[h](s),s===void 0&&(j=!1)}catch(g){console.error("Failed to format arguments",g)}}}if(j&&s!==void 0){let l=Array.isArray(s)?s:[s];if(t===A){let c=[i];c.push(...n.split(this.context.options.keySeparator));let h=c.pop(),g=this.context.monitor.get(c,"info");g.value[h]=s}else if(t?.default)t.default.call(t,...l);else if(typeof t=="function")o[n][C]?t.call(a?.[f.listeners.bind]?.value??this.context.instance,...l):t(...l);else{let c=n?`listener: ${e} \u2014> ${n}`:`listener from ${e}`;o?(console.warn(`Deleting ${c}`,t),delete o[n]):console.error(`Failed to add ${c}`,t)}}};this.context=s,this.rootPath=t,this.original=e,[{name:"active",ref:w},{name:"from",ref:F},{name:"to",ref:G}].forEach(o=>{o.ref[this.context.id]||(o.ref[this.context.id]={}),this.globals[o.name]=o.ref[this.context.id]}),this.#o=this.getManager(),this.runEachListener(e,this.addToGlobalLog)}#e;#s;#o;#n;#i;#t},q=I;typeof globalThis.edgelord<"u"?Object.assign(globalThis.edgelord,_):globalThis.edgelord=_;})();
//# sourceMappingURL=index.js.map
