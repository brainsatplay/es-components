# ES Components 
[![License: AGPL v3](https://img.shields.io/badge/license-AGPL_v3-blue.svg)](https://www.gnu.org/licenses/agpl-3.0)
[![Discord](https://img.shields.io/badge/community-discord-7289da.svg?sanitize=true)](https://discord.gg/CDxskSh9ZB)

**ES Components (ESC)** is a standard format for transforming Objects into composable Web Components to simplify the creation of complex web applications.

> **ESC** is a core specification of [Brains@Play].

## Getting Started
To get started with ESC, you can simply grab one of the available parsers like [escode] to instantiate your Components:
```js
import { create } from 'escode'

const esc = {
    nExecutions: 0,
    default: function(){
        this.nExecutions++
        return this.nExecutions
    },
    __children: {
        nested: {
            value: 0
        }
    }, 
    __listeners: {
        default: 'nested',
        nested: (update) => {
            console.log('Updated nested value', update)
        }
    },
}
```

## The Specification
### The Root Property (__)
The `__` property distinguishes an active ES object from others and is used to store Component properties that are automatically generated by the [escompose](#) library:

- `graph`: The root Component that this Component is attached to.
- `original`: The original Component that this Component was created from.
- `state`: Coming soon...

#### The Hierarchy Property (__children)
This is a collection of ESC instances that determine how they will be displayed on the screen—as well as how they're referenced in listener scope.

#### The Reaction Property (__listeners)
This is a collection of configuration objects that specify how ESC will listen to each other.

#### The Proxy Property (__props)
Coming soon...

#### The Parent Property (__parent)
Coming soon...

#### The Lifecycle Properties (__onconnected, __ondisconnected)
Coming soon...

#### The Composition Properties (__compose, __apply)
- [x] WASM Support (__compose)

The `__compose` property is used to construct a base object to apply your Component. This is useful for creating a Component that inherits from another Component. 

Conversely, the `__apply` property is used to override properties on your component after complete resolution.

### The DOM Properties (__element, __attributes, __define)
The `__element` property is used to register a DOM Element for your Component.

The `__attributes` property is used to add attributes to this element.

Additionally, the `__define` property is used to register Web Components.

### Animation
#### __animate
This allows you to specify an animation loop for your component.

## Writing ESC Parsers
Writing a library to parse ES Components is very simple. [escode] already exists to serve this purpose—but you're welcome to roll your own for JavaScript or other programming environments!

1. Track inputs
2. Parse the configuration object
3. Add the root identifier
4. Apply the overrides
5. Run core loaders
6. Run external loaders
7. Apply the override
8. Return the component

### Track Inputs
The Component constructor must accept a **configuration** object, a **property override** object, and an **options** object.

### Parse the Configuration Object
#### Components
Object, Classes, and Functions. Each is instanced slightly differently.

#### Trees
Trees are a sheet of components that a user can provide as an initial input to the create function.

#### Arrays
Arrays allow for bulk operations on the above configuration objects.

### Add the Root Identifier
Add a __ property to the root of the component to provide methods and track internal properties.

### Apply the Overrides
This is where override properties should be merged into the object.

### Run Core Loaders
Loaders are run on the component to activate other ES properties. Their arguments are the **partial ES Component** and the **options** used to construct it.

#### Recognize an Operator
Override the behavior of the default property. Make sure the children nodes pass messages to each other if this exists.

#### Parse Children
Nested components are nested objects that have at least one `__` property—even if it simply involves setting `__` to `true`—that should be parsed the the **loaders**. 

> **Note:** To read more about why we chose this syntax, read our [design choices](./DESIGN.md) document.

To avoid an exhaustive search, **only top-level properties are parsed**. 

#### Activate Listeners
Listeners are specified as string paths to object properties. They are stored relative to the graph root on a global list and called directly from a **single manager object shared across Components**.
- Functions are proxied
- Getters and setters are used for all properties. New functions are proxied again.

If an `__operator` property is provided on the object, that should be fired if the target of a listener is a Component. Otherwise this should trigger the default property.


### Run User-Defined Loaders 
External loaders can use the following callbacks to link into the core loaders:
- `__.start.add`: Called when the node is started
- `__.stop.add`: Called when the node is started
- `__.children.onChildAdded`: Called when a child is added
- `__.children.onChildRemoved`: Called when a child is removed

### Return the Component
These are always JavaScript Objects. This avoids the extra layer of proxying that would be required by creating a wrapper class.

## Scripting with ES Module Files
Many users will find it easier to declare reusable Components in their own ES Module (ESM) files rather than other script files.

Using this syntax, each Component contains one `default` export and any number of `named` exports.

```js
export let nExecutions = 0

export const __children = {
    nested: {
        value: 0
    }
}

export const __listeners = {
    default: 'nested',
    nested: (update) => {
        console.log('Updated nested value', update)
    }
}

export default function(){
    this.nExecutions++
    return this.nExecutions
}
```

When using these components, you will rely on **namespace imports** (which access default *and* named exports) to access the component in full.

```js
import * as component from './index.esc.js'
```

### Third-Party Loaders
#### [escode-animation-loader](https://github.com/escode/packages/escode-animation-loader)
The `__animate` property allows you to specify an animation loop for your component.

## Roadmap
- Declare ESC with similar detail to [ESM](https://tc39.es/ecma262/#sec-modules).

[Brains@Play]:https://github.com/brainsatplay