(()=>{function M(c=""){let t=a=>a.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),s=(a=>{let n=a.indexOf("=>")+1;return n<=0&&(n=a.indexOf("){")),n<=0&&(n=a.indexOf(") {")),a.slice(0,a.indexOf("{",n)+1)})(c),i=t(c),r;if(s.includes("function")){let a=s.split("(")[1].split(")")[0];r=new Function(a,i)}else if(s.substring(0,6)===i.substring(0,6)){let a=s.split("(")[1].split(")")[0];r=new Function(a,i.substring(i.indexOf("{")+1,i.length-1))}else try{r=(0,eval)(s+i+"}")}catch{}return r}var N={pushToState:{},data:{},triggers:{},setState(c){Object.assign(N.data,c);for(let t of Object.getOwnPropertyNames(c))N.triggers[t]&&N.triggers[t].forEach(e=>e.onchange(N.data[t]));return N.data},subscribeTrigger(c,t){if(c){N.triggers[c]||(N.triggers[c]=[]);let e=N.triggers[c].length;return N.triggers[c].push({idx:e,onchange:t}),N.triggers[c].length-1}else return},unsubscribeTrigger(c,t){let e,s=N.triggers[c];if(s)if(!t)delete N.triggers[c];else return s.find(r=>{if(r.idx===t)return!0})&&s.splice(e,1),!0},subscribeTriggerOnce(c,t){let e,s=i=>{t(i),N.unsubscribeTrigger(c,e)};e=N.subscribeTrigger(c,s)}},g=class{constructor(t={},e,s){this.nodes=new Map;this._initial={};this.state=N;this.isLooping=!1;this.isAnimating=!1;this.looper=void 0;this.animation=void 0;this.forward=!0;this.backward=!1;this.runSync=!1;this.firstRun=!0;this.DEBUGNODE=!1;this.operator=(...t)=>t;this.runOp=(...t)=>{this.DEBUGNODE&&console.time(this.tag);let e=this.operator(...t);return e instanceof Promise?e.then(s=>(s!==void 0&&this.setState({[this.tag]:s}),this.DEBUGNODE&&(console.timeEnd(this.tag),e!==void 0&&console.log(`${this.tag} result:`,e)),s)):(e!==void 0&&this.setState({[this.tag]:e}),this.DEBUGNODE&&(console.timeEnd(this.tag),e!==void 0&&console.log(`${this.tag} result:`,e))),e};this.setOperator=t=>(typeof t!="function"||(this.operator=t.bind(this)),t);this.runAsync=(...t)=>new Promise((e,s)=>{e(this.run(...t))});this.transformArgs=(t=[])=>t;this.run=(...t)=>{if(typeof this.transformArgs=="function"&&(t=this.transformArgs(t,this)),!(this.firstRun&&(this.firstRun=!1,this.children&&this.forward||this.parent&&this.backward||this.repeat||this.delay||this.frame||this.recursive||this.branch||(this.runSync=!0),this.animate&&!this.isAnimating&&this.runAnimation(this.animation,t),this.loop&&typeof this.loop=="number"&&!this.isLooping&&this.runLoop(this.looper,t),this.loop||this.animate)))return this.runSync?this.runOp(...t):new Promise(async e=>{if(this){let s=(r,a=0,...n)=>new Promise(async o=>{a++;let l=await r.runOp(...n);if(r.repeat){for(;a<r.repeat;){if(r.delay){setTimeout(async()=>{o(await s(r,a,...n))},r.delay);break}else if(r.frame&&window?.requestAnimationFrame){requestAnimationFrame(async()=>{o(await s(r,a,...n))});break}else l=await r.runOp(...n);a++}if(a===r.repeat){o(l);return}}else if(r.recursive){for(;a<r.recursive;){if(r.delay){setTimeout(async()=>{o(await s(r,a,...l))},r.delay);break}else if(r.frame&&window?.requestAnimationFrame){requestAnimationFrame(async()=>{o(await s(r,a,...l))});break}else l=await r.runOp(...l);a++}if(a===r.recursive){o(l);return}}else{o(l);return}}),i=async()=>{let r=await s(this,void 0,...t);return r!==void 0&&(this.backward&&this.parent instanceof g&&(Array.isArray(r)?await this.runParent(this,...r):await this.runParent(this,r)),this.children&&this.forward&&(Array.isArray(r)?await this.runChildren(this,...r):await this.runChildren(this,r)),this.branch&&this.runBranch(this,r)),r};this.delay?setTimeout(async()=>{e(await i())},this.delay):this.frame&&window?.requestAnimationFrame?requestAnimationFrame(async()=>{e(await i())}):e(await i())}else e(void 0)})};this.runParent=async(t,...e)=>{t.backward&&t.parent&&(typeof t.parent=="string"&&(t.graph&&t.graph?.get(t.parent)?(t.parent=t.graph,t.parent&&this.nodes.set(t.parent.tag,t.parent)):t.parent=this.nodes.get(t.parent)),t.parent instanceof g&&await t.parent.run(...e))};this.runChildren=async(t,...e)=>{if(typeof t.children=="object")for(let s in t.children)typeof t.children[s]=="string"?(t.graph&&t.graph?.get(t.children[s])&&(t.children[s]=t.graph.get(t.children[s]),t.nodes.get(t.children[s].tag)||t.nodes.set(t.children[s].tag,t.children[s])),!t.children[s]&&t.nodes.get(t.children[s])&&(t.children[s]=t.nodes.get(t.children[s]))):(typeof t.children[s]>"u"||t.children[s]===!0)&&(t.graph&&t.graph?.get(s)&&(t.children[s]=t.graph.get(s),t.nodes.get(t.children[s].tag)||t.nodes.set(t.children[s].tag,t.children[s])),!t.children[s]&&t.nodes.get(s)&&(t.children[s]=t.nodes.get(s))),t.children[s]?.runOp&&await t.children[s].run(...e)};this.runBranch=async(t,e)=>{if(t.branch){let s=Object.keys(t.branch);await Promise.all(s.map(async i=>{typeof t.branch[i].if=="object"&&(t.branch[i].if=R(t.branch[i].if));let r=!1;return typeof t.branch[i].if=="function"?r=t.branch[i].if(e):typeof e=="object"?R(e)===t.branch[i].if&&(r=!0):e===t.branch[i].if&&(r=!0),r&&(t.branch[i].then instanceof g?Array.isArray(e)?await t.branch[i].then.run(...e):await t.branch[i].then.run(...e):typeof t.branch[i].then=="function"?Array.isArray(e)?await t.branch[i].then(...e):await t.branch[i].then(e):typeof t.branch[i].then=="string"&&(t.graph?t.branch[i].then=t.graph.nodes.get(t.branch[i].then):t.branch[i].then=t.nodes.get(t.branch[i].then),t.branch[i].then instanceof g&&(Array.isArray(e)?await t.branch[i].then.run(...e):await t.branch[i].then.run(...e)))),r}))}};this.runAnimation=(t=this.animation,e=[])=>{if(this.animation=t,t||(this.animation=this.operator),this.animate&&!this.isAnimating&&"requestAnimationFrame"in window){this.isAnimating=!0;let s=async()=>{if(this.isAnimating){this.DEBUGNODE&&console.time(this.tag);let i=this.animation.call(this,...e);i instanceof Promise&&(i=await i),this.DEBUGNODE&&(console.timeEnd(this.tag),i!==void 0&&console.log(`${this.tag} result:`,i)),i!==void 0&&(this.tag&&this.setState({[this.tag]:i}),this.backward&&this.parent?.run&&(Array.isArray(i)?await this.runParent(this,...i):await this.runParent(this,i)),this.children&&this.forward&&(Array.isArray(i)?await this.runChildren(this,...i):await this.runChildren(this,i)),this.branch&&this.runBranch(this,i),this.setState({[this.tag]:i})),requestAnimationFrame(s)}};requestAnimationFrame(s)}};this.runLoop=(t=this.looper,e=[],s=this.loop)=>{if(this.looper=t,t||(this.looper=this.operator),typeof s=="number"&&!this.isLooping){this.isLooping=!0;let i=async()=>{if(this.isLooping){this.DEBUGNODE&&console.time(this.tag);let r=this.looper.call(this,...e);r instanceof Promise&&(r=await r),this.DEBUGNODE&&(console.timeEnd(this.tag),r!==void 0&&console.log(`${this.tag} result:`,r)),r!==void 0&&(this.tag&&this.setState({[this.tag]:r}),this.backward&&this.parent?.run&&(Array.isArray(r)?await this.runParent(this,...r):await this.runParent(this,r)),this.children&&this.forward&&(Array.isArray(r)?await this.runChildren(this,...r):await this.runChildren(this,r)),this.branch&&this.runBranch(this,r),this.setState({[this.tag]:r})),setTimeout(async()=>{await i()},s)}};i()}};this.setParent=t=>{this.parent=t,this.backward&&(this.runSync=!1)};this.setChildren=t=>{this.children=t,this.forward&&(this.runSync=!1)};this.add=(t={})=>(typeof t=="function"&&(t={operator:t}),t instanceof g||(t=new g(t,this,this.graph)),this.nodes.set(t.tag,t),this.graph&&(this.graph.nodes.set(t.tag,t),this.graph.nNodes=this.graph.nodes.size),t);this.remove=t=>{typeof t=="string"&&(t=this.nodes.get(t)),t instanceof g&&(this.nodes.delete(t.tag),this.children[t.tag]&&delete this.children[t.tag],this.graph&&(this.graph.nodes.delete(t.tag),this.graph.nNodes=this.graph.nodes.size),this.nodes.forEach(e=>{e.nodes.get(e.tag)&&(e.nodes.delete(e.tag),e.children[e.tag]&&delete e.children[e.tag],e.parent?.tag===e.tag&&delete e.parent)}),t.ondelete&&t.ondelete(t))};this.append=(t,e=this)=>{typeof t=="string"&&(t=this.nodes.get(t)),t instanceof g&&(e.addChildren(t),t.forward&&(t.runSync=!1))};this.subscribe=(t,e=this.tag)=>t instanceof g?this.subscribeNode(t):this.state.subscribeTrigger(e,t);this.unsubscribe=(t,e=this.tag)=>{this.state.unsubscribeTrigger(e,t)};this.addChildren=t=>{this.children||(this.children={}),typeof t=="object"&&Object.assign(this.children,t),this.convertChildrenToNodes(),this.forward&&(this.runSync=!1)};this.callParent=(...t)=>{if(typeof this.parent=="string"&&(this.graph&&this.graph?.get(this.parent)?(this.parent=this.graph,this.parent&&this.nodes.set(this.parent.tag,this.parent)):this.parent=this.nodes.get(this.parent)),typeof this.parent?.operator=="function")return this.parent.runOp(...t)};this.callChildren=(...t)=>{let e;if(typeof this.children=="object")for(let s in this.children)this.children[s]?.runOp&&this.children[s].runOp(...t);return e};this.getProps=(t=this)=>({tag:t.tag,operator:t.operator,graph:t.graph,children:t.children,parent:t.parent,forward:t.forward,backward:t.bacward,loop:t.loop,animate:t.animate,frame:t.frame,delay:t.delay,recursive:t.recursive,repeat:t.repeat,branch:t.branch,oncreate:t.oncreate,DEBUGNODE:t.DEBUGNODE,...this._initial});this.setProps=(t={})=>{let e=Object.assign({},t);e.children&&(this.addChildren(t.children),delete e.children),e.operator&&(this.setOperator(t.operator),delete e.operator),Object.assign(e,t),this.children&&this.forward||this.parent&&this.backward||this.repeat||this.delay||this.frame||this.recursive||(this.runSync=!0)};this.removeTree=t=>{if(t&&typeof t=="string"&&(t=this.nodes.get(t)),t instanceof g){let e={},s=i=>{if(typeof i.children=="object"&&!e[i.tag]){e[i.tag]=!0;for(let r in i.children)i.children[r].stopNode&&i.children[r].stopNode(),i.children[r].tag&&(this.nodes.get(i.children[r].tag)&&this.nodes.delete(i.children[r].tag),this.nodes.forEach(a=>{a.nodes.get(i.children[r].tag)&&a.nodes.delete(i.children[r].tag),a.children[r]instanceof g&&delete a.children[r]}),s(i.children[r]))}};t.stopNode&&t.stopNode(),t.tag&&(this.nodes.delete(t.tag),this.children[t.tag]&&delete this.children[t.tag],this.parent?.tag===t.tag&&delete this.parent,this[t.tag]instanceof g&&delete this[t.tag],this.nodes.forEach(i=>{i?.tag&&(i.nodes.get(i.tag)&&i.nodes.delete(i.tag),i.children[i.tag]instanceof g&&delete i.children[i.tag])}),s(t),this.graph?this.graph.removeTree(t,e):t.ondelete&&t.ondelete(t))}};this.checkNodesHaveChildMapped=(t,e,s={})=>{let i=t.tag;i||(i=t.name),s[i]||(s[i]=!0,t.children&&e.tag in t.children&&t.children[e.tag]instanceof g&&(t.nodes.get(e.tag)||t.nodes.set(e.tag,e),t.children[e.tag]=e,t.firstRun||(t.firstRun=!0)),t.parent instanceof g&&(t.nodes.get(e.tag)&&!t.parent.nodes.get(e.tag)&&t.parent.nodes.set(e.tag,e),t.parent.children?this.checkNodesHaveChildMapped(t.parent,e,s):t.nodes&&t.nodes.forEach(r=>{s[r.tag]||this.checkNodesHaveChildMapped(r,e,s)})),t.graph&&t.parent&&t.parent.name!==t.graph.name&&t.graph.nodes.forEach(r=>{s[r.tag]||this.checkNodesHaveChildMapped(r,e,s)}))};this.convertChildrenToNodes=(t=this)=>{if(t?.children){for(let e in t.children)if(!(t.children[e]instanceof g))if(typeof t.children[e]=="object")t.children[e].tag||(t.children[e].tag=e),t.nodes.get(t.children[e].tag)||(t.children[e]=new g(t.children[e],t,t.graph),this.checkNodesHaveChildMapped(t,t.children[e]));else{if(typeof t.children[e]>"u"||t.children[e]==!0)t.children[e]=t.graph.get(e),t.children[e]||(t.children[e]=t.nodes.get(e));else if(typeof t.children[e]=="string"){let s=t.children[e];t.children[e]=t.graph.get(s),t.children[e]||(t.children[e]=t.nodes.get(e))}if(t.children[e]instanceof g){if(t.graph){let s=t.children[e].getProps();delete s.parent,delete s.graph,t.source instanceof b?t.children[e]=new g(s,t,t.source):t.children[e]=new g(s,t,t.graph)}t.nodes.set(t.children[e].tag,t.children[e]),this.checkNodesHaveChildMapped(t,t.children[e]),t.children[e].tag in t||(t[t.children[e].tag]=t.children[e])}}}return t.children};this.stopLooping=(t=this)=>{t.isLooping=!1};this.stopAnimating=(t=this)=>{t.isAnimating=!1};this.stopNode=(t=this)=>{t.stopAnimating(t),t.stopLooping(t)};this.subscribeNode=t=>{if(typeof t=="string"&&(t=this.nodes.get(t)),t.tag&&this.nodes.set(t.tag,t),t)return this.state.subscribeTrigger(this.tag,e=>{Array.isArray(e)?t.run(...e):t.run(e)})};this.print=(t=this,e=!0,s=[])=>{let i=new g;if(typeof t=="string"&&(t=this.nodes.get(t)),t instanceof g){s.push(t.tag);let r={tag:t.tag,operator:t.operator.toString()};if(t.parent&&(r.parent=t.parent.tag),typeof t.children=="object")for(let a in t.children)return typeof t.children[a]=="string"?t.children[a]:s.includes(t.children[a].tag)?t.children[a].tag:e?t.children[a].print(t.children[a],e,s):t.children[a].tag;for(let a in t)a==="parent"||a==="children"||typeof i[a]>"u"&&(typeof t[a]=="function"?r[a]=t[a].toString():typeof t[a]=="object"?r[a]=JSON.stringifyWithCircularRefs(t[a]):r[a]=t[a]);return JSON.stringify(r)}};this.reconstruct=t=>{let e=T(t);if(e)return this.add(e)};this.setState=this.state.setState;this.DEBUGNODES=(t=!0)=>{this.DEBUGNODE=t,this.nodes.forEach(e=>{t?e.DEBUGNODE=!0:e.DEBUGNODE=!1})};if(typeof t=="function"&&(t={operator:t}),typeof t=="object"){if(t instanceof g&&t._initial&&Object.assign(t,t._initial),t instanceof b){let r=t;t={source:r,operator:a=>{if(typeof a=="object"){let n={};for(let o in a)typeof r[o]=="function"?Array.isArray(a[o])?n[o]=r[o](...a[o]):n[o]=r[o](a[o]):(r[o]=a[o],n[o]=r[o]);return n}return r}},r.operator&&(t.operator=r.operator),r.children&&(t.children=r.children),r.forward&&(t.forward=r.forward),r.backward&&(t.backward=r.backward),r.repeat&&(t.repeat=r.repeat),r.recursive&&(t.recursive=r.recursive),r.loop&&(t.loop=r.loop),r.animate&&(t.animate=r.animate),r.looper&&(t.looper=r.looper),r.animation&&(t.animation=r.animation),r.delay&&(t.delay=r.delay),r.tag&&(t.tag=r.tag),r.oncreate&&(t.oncreate=r.oncreate),r.node&&r.node._initial&&Object.assign(t,r.node._initial),r._initial&&Object.assign(t,r._initial),this.nodes=r.nodes,r.node=this,s&&r.nodes.forEach(a=>{s.nodes.get(a.tag)||(s.nodes.set(a.tag,a),s.nNodes++)})}if(t.tag&&(s||e)){let r;if(s?.nodes&&(r=s.nodes.get(t.tag)),!r&&e?.nodes&&(r=e.nodes.get(t.tag)),r){for(let n in r)this[n]=r[n];this.source||(this.source=r);let a=r.getProps();delete a.graph,delete a.parent;for(let n in a)t[n]=a[n]}}t?.operator&&(t.operator=this.setOperator(t.operator)),!t.tag&&s?t.tag=`node${s.nNodes}`:t.tag||(t.tag=`node${Math.floor(Math.random()*1e10)}`);let i=Object.getOwnPropertyNames(this);for(let r in t)i.includes(r)||(this._initial[r]=t[r]);t.children&&(this._initial.children=Object.assign({},t.children));for(let r in t)this[r]=t[r];if(this.tag||(s?this.tag=`node${s.nNodes}`:this.tag=`node${Math.floor(Math.random()*1e10)}`),s&&(this.graph=s,s.nodes.get(this.tag)&&(this.tag=`${this.tag}${s.nNodes+1}`),s.nodes.set(this.tag,this),s.nNodes++),e&&(this.parent=e,(e instanceof g||e instanceof b)&&e.nodes.set(this.tag,this)),typeof t.tree=="object")for(let r in t.tree){typeof t.tree[r]=="object"&&(!t.tree[r]).tag&&(t.tree[r].tag=r);let a=new g(t.tree[r],this,s);this.nodes.set(a.tag,a)}this.children&&this.convertChildrenToNodes(this),(this.parent instanceof g||this.parent instanceof b)&&this.checkNodesHaveChildMapped(this.parent,this),typeof this.oncreate=="function"&&this.oncreate(this),this.firstRun||(this.firstRun=!0)}else return t}},b=class{constructor(t,e,s){this.nNodes=0;this.nodes=new Map;this.state=N;this.tree={};this.add=(t={})=>{let e=t;return t instanceof g?(this.nNodes=this.nodes.size,t.tag&&(this.tree[t.tag]=e,this.nodes.set(t.tag,t))):t=new g(e,this,this),t};this.setTree=(t=this.tree)=>{if(!!t){for(let e in t){let s=this.nodes.get(e);if(s){if(typeof t[e]=="function")s.setOperator(t[e]);else if(typeof t[e]=="object")if(t[e]instanceof g)this.add(t[e]);else if(t[e]instanceof b){let i=t[e],r={};i.operator&&(r.operator=i.operator),i.children&&(r.children=i.children),i.forward&&(r.forward=i.forward),i.backward&&(r.backward=i.backward),i.repeat&&(r.repeat=i.repeat),i.recursive&&(r.recursive=i.recursive),i.loop&&(r.loop=i.loop),i.animate&&(r.animate=i.animate),i.looper&&(r.looper=i.looper),i.animation&&(r.animation=i.animation),i.delay&&(r.delay=i.delay),i.tag&&(r.tag=i.tag),i.oncreate&&(r.oncreate=i.oncreate),i.node?._initial&&Object.assign(r,i.node._initial),r.nodes=i.nodes,r.source=i,s.setProps(r)}else s.setProps(t[e])}else if(typeof t[e]=="function")this.add({tag:e,operator:t[e]});else if(typeof t[e]=="object"&&!Array.isArray(t[e])){t[e].tag||(t[e].tag=e);let i=this.add(t[e]);t[e].aliases&&t[e].aliases.forEach(r=>{this.nodes.set(r,i)})}else this.add({tag:e,operator:(...i)=>t[e]})}this.nodes.forEach(e=>{if(typeof e.children=="object")for(let s in e.children)typeof e.children[s]=="string"?this.nodes.get(e.children[s])&&(e.children[s]=this.nodes.get(e.children[s])):(e.children[s]===!0||typeof e.children[s]>"u")&&this.nodes.get(s)&&(e.children[s]=this.nodes.get(s)),e.children[s]instanceof g&&e.checkNodesHaveChildMapped(e,e.children[s]);typeof e.parent=="string"&&this.nodes.get(e.parent)&&(e.parent=this.nodes.get(e.parent),e.nodes.set(e.parent.tag,e.parent))})}};this.get=t=>this.nodes.get(t);this.set=t=>this.nodes.set(t.tag,t);this.run=(t,...e)=>{if(typeof t=="string"&&(t=this.nodes.get(t)),t instanceof g)return t.run(...e)};this.runAsync=(t,...e)=>(typeof t=="string"&&(t=this.nodes.get(t)),t instanceof g?new Promise((s,i)=>{s(t.run(...e))}):new Promise((s,i)=>{s(void 0)}));this.removeTree=(t,e)=>{if(typeof t=="string"&&(t=this.nodes.get(t)),t instanceof g){e||(e={});let s=i=>{i.children&&!e[i.tag]&&(e[i.tag]=!0,Array.isArray(i.children)?i.children.forEach(r=>{r.stopNode&&r.stopNode(),r.tag&&this.nodes.get(r.tag)&&this.nodes.delete(r.tag),this.nodes.forEach(a=>{a.nodes.get(r.tag)&&a.nodes.delete(r.tag)}),s(r)}):typeof i.children=="object"&&(i.stopNode&&i.stopNode(),i.tag&&this.nodes.get(i.tag)&&this.nodes.delete(i.tag),this.nodes.forEach(r=>{r.nodes.get(i.tag)&&r.nodes.delete(i.tag)}),s(i)))};t.stopNode&&t.stopNode(),t.tag&&(this.nodes.delete(t.tag),this.nodes.forEach(i=>{i.nodes.get(i.tag)&&i.nodes.delete(i.tag)}),this.nNodes=this.nodes.size,s(t)),t.ondelete&&t.ondelete(t)}return t};this.remove=t=>(typeof t=="string"&&(t=this.nodes.get(t)),t instanceof g&&(t.stopNode(),t?.tag&&this.nodes.get(t.tag)&&(this.nodes.delete(t.tag),this.nodes.forEach(e=>{e.nodes.get(e.tag)&&e.nodes.delete(e.tag)})),t.ondelete&&t.ondelete(t)),t);this.append=(t,e)=>{e.addChildren(t)};this.callParent=async(t,...e)=>{if(t?.parent)return await t.callParent(...e)};this.callChildren=async(t,...e)=>{if(t?.children)return await t.callChildren(...e)};this.subscribe=(t,e)=>{if(!!e){if(t instanceof g&&typeof e=="function")return t.subscribe(e);if(e instanceof g||typeof e=="string")return this.subscribeNode(t,e);if(typeof t=="string")return this.state.subscribeTrigger(t,e)}};this.unsubscribe=(t,e)=>{this.state.unsubscribeTrigger(t,e)};this.subscribeNode=(t,e)=>{let s;if(t?.tag?s=t.tag:typeof t=="string"&&(s=t),typeof e=="string"&&(e=this.nodes.get(e)),t&&e)return this.state.subscribeTrigger(s,r=>{Array.isArray(r)?e.run(...r):e.run(r)})};this.stopNode=t=>{typeof t=="string"&&(t=this.nodes.get(t)),t instanceof g&&t.stopNode()};this.print=(t=void 0,e=!0)=>{if(t instanceof g)return t.print(t,e);{let s="{";return this.nodes.forEach(i=>{s+=`
"${i.tag}:${i.print(i,e)}"`}),s}};this.reconstruct=t=>{let e=T(t);if(e)return this.add(e)};this.create=(t,e,s)=>P(t,e,s,this);this.setState=this.state.setState;this.DEBUGNODES=(t=!0)=>{this.nodes.forEach(e=>{t?e.DEBUGNODE=!0:e.DEBUGNODE=!1})};if(this.tag=e||`graph${Math.floor(Math.random()*1e11)}`,s){for(let i in s)this[i]=s[i];this._initial=s}(t||Object.keys(this.tree).length>0)&&this.setTree(t)}};function T(c="{}"){try{let t=typeof c=="string"?JSON.parse(c):c,e=s=>{for(let i in s)if(typeof s[i]=="string"){let r=M(s[i]);typeof r=="function"&&(s[i]=r)}else typeof s[i]=="object"&&e(s[i]);return s};return e(t)}catch(t){console.error(t);return}}var C=function(){let c=new Map,t=[],e=["this"];function s(){c.clear(),t.length=0,e.length=1}function i(a,n){var o=t.length-1,l=t[o];if(typeof l=="object")if(l[a]===n||o===0)e.push(a),t.push(n.pushed);else for(;o-->=0;){if(l=t[o],typeof l=="object"&&l[a]===n){o+=2,t.length=o,e.length=o,--o,t[o]=n,e[o]=a;break}o--}}function r(a,n){if(n!=null&&typeof n=="object"){a&&i(a,n);let o=c.get(n);if(o)return"[Circular Reference]"+o;c.set(n,e.join("."))}return n}return function(n,o){try{return t.push(n),JSON.stringify(n,r,o)}finally{s()}}}();JSON.stringifyWithCircularRefs===void 0&&(JSON.stringifyWithCircularRefs=C);var R=function(){let c=new Map,t=[],e=["this"];function s(){c.clear(),t.length=0,e.length=1}function i(a,n){var o=t.length-1;if(t[o]){var l=t[o];if(typeof l=="object")if(l[a]===n||o===0)e.push(a),t.push(n.pushed);else for(;o-->=0;){if(l=t[o],typeof l=="object"&&l[a]===n){o+=2,t.length=o,e.length=o,--o,t[o]=n,e[o]=a;break}o++}}}function r(a,n){let o;if(n!=null)if(typeof n=="object"){let l=n.constructor.name;a&&l==="Object"&&i(a,n);let h=c.get(n);if(h)return"[Circular Reference]"+h;if(c.set(n,e.join(".")),l==="Array")n.length>20?o=n.slice(n.length-20):o=n;else if(l.includes("Set"))o=Array.from(n);else if(l!=="Object"&&l!=="Number"&&l!=="String"&&l!=="Boolean")o="instanceof_"+l;else if(l==="Object"){let f={};for(let d in n)if(n[d]==null)f[d]=n[d];else if(Array.isArray(n[d]))n[d].length>20?f[d]=n[d].slice(n[d].length-20):f[d]=n[d];else if(n[d].constructor.name==="Object"){f[d]={};for(let p in n[d])if(Array.isArray(n[d][p]))n[d][p].length>20?f[d][p]=n[d][p].slice(n[d][p].length-20):f[d][p]=n[d][p];else if(n[d][p]!=null){let u=n[d][p].constructor.name;u.includes("Set")?f[d][p]=Array.from(n[d][p]):u!=="Number"&&u!=="String"&&u!=="Boolean"?f[d][p]="instanceof_"+u:f[d][p]=n[d][p]}else f[d][p]=n[d][p]}else{let p=n[d].constructor.name;p.includes("Set")?f[d]=Array.from(n[d]):p!=="Number"&&p!=="String"&&p!=="Boolean"?f[d]="instanceof_"+p:f[d]=n[d]}o=f}else o=n}else o=n;return o}return function(n,o){t.push(n);let l=JSON.stringify(n,r,o);return s(),l}}();JSON.stringifyFast===void 0&&(JSON.stringifyFast=R);function P(c,t,e,s){return typeof e=="object"?(e.operator=c,new g(e,t,s)):new g({operator:c},t,s)}var A=class extends HTMLElement{template=function(t=this,e){return`<div> Custom Fragment Props: ${JSON.stringify(e)} </div>`};props={};useShadow=!1;styles;oncreate;onresize;ondelete;onchanged;renderonchanged=!1;FRAGMENT;STYLE;attachedShadow=!1;obsAttributes=["props","options","onchanged","onresize","ondelete","oncreate","template"];get observedAttributes(){return this.obsAttributes}get obsAttributes(){return this.obsAttributes}set obsAttributes(t){typeof t=="string"?this.obsAttributes.push(t):Array.isArray(t)&&(this.obsAttributes=t)}static get tag(){return this.name.toLowerCase()+"-"}static addElement(t=this.tag,e=this,s=void 0){x(e,t,s)}attributeChangedCallback=(t,e,s)=>{if(t==="onchanged"){let i=s;if(typeof i=="string"&&(i=O(i)),typeof i=="function"){this.onchanged=i,this.state.data.props=this.props,this.state.unsubscribeTrigger("props"),this.state.subscribeTrigger("props",this.onchanged);let r=new CustomEvent("changed",{detail:{props:this.props,self:this}});this.state.subscribeTrigger("props",()=>{this.dispatchEvent(r)})}}else if(t==="onresize"){let i=s;if(typeof i=="string"&&(i=O(i)),typeof i=="function"){if(this.ONRESIZE)try{window.removeEventListener("resize",this.ONRESIZE)}catch{}this.ONRESIZE=r=>{this.onresize(this.props,this)},this.onresize=i,window.addEventListener("resize",this.ONRESIZE)}}else if(t==="ondelete"){let i=s;typeof i=="string"&&(i=O(i)),typeof i=="function"&&(this.ondelete=()=>{this.ONRESIZE&&window.removeEventListener("resize",this.ONRESIZE),this.state.unsubscribeTrigger("props"),i&&i(this.props,this)})}else if(t==="oncreate"){let i=s;typeof i=="string"&&(i=O(i)),typeof i=="function"&&(this.oncreate=i)}else if(t==="renderonchanged"){let i=s;typeof this.renderonchanged=="number"&&this.unsubscribeTrigger(this.renderonchanged),typeof i=="string"&&(i=O(i)),typeof i=="function"?this.renderonchanged=this.state.subscribeTrigger("props",r=>{this.render(r),i(this,r)}):i!=!1&&(this.renderonchanged=this.state.subscribeTrigger("props",this.render))}else if(t==="props"){let i=s;typeof i=="string"&&(i=JSON.parse(i)),Object.assign(this.props,i),this.state.setState({props:this.props})}else if(t==="template"){let i=s;this.template=i,this.render(this.props);let r=new CustomEvent("created",{detail:{props:this.props}});this.dispatchEvent(r)}else{let i=s;if(t.includes("eval_"))t=t.split("_"),t.shift(),t=t.join(),i=O(s);else if(typeof s=="string")try{i=JSON.parse(s)}catch{i=s}this[t]=i,t!=="props"&&this.props&&(this.props[t]=i)}};connectedCallback(){this.props||(this.props={});let t=this.getAttribute("props");typeof t=="string"&&(t=JSON.parse(t)),Object.assign(this.props,t),this.state.setState({props:this.props}),Array.from(this.attributes).forEach(a=>{let n=a.name,o=a.value;if(n.includes("eval_")||n.includes("()"))n.includes("eval_")?n=n.split("_"):n.includes("()")&&(n=n.substring(0,n.indexOf("("))),n.shift(),n=n.join(),o=O(a.value);else if(typeof a.value=="string")try{o=JSON.parse(a.value)}catch{o=a.value}this[n]||Object.defineProperties(this,a,{value:o,writable:!0,get(){return this[n]},set(l){this.setAttribute(n,l)}}),this[n]=o,n!=="props"&&(this.props[n]=o),this.obsAttributes.push(n)});let e=new CustomEvent("resized",{detail:{props:this.props,self:this}}),s=new CustomEvent("changed",{detail:{props:this.props,self:this}}),i=new CustomEvent("deleted",{detail:{props:this.props,self:this}}),r=new CustomEvent("created",{detail:{props:this.props,self:this}});if(this.render(this.props),this.dispatchEvent(r),this.state.subscribeTrigger("props",()=>{this.dispatchEvent(s)}),typeof this.onresize=="function"){if(this.ONRESIZE)try{window.removeEventListener("resize",this.ONRESIZE)}catch{}this.ONRESIZE=a=>{this.onresize(this,this.props),this.dispatchEvent(e)},window.addEventListener("resize",this.ONRESIZE)}if(typeof this.ondelete=="function"){let a=this.ondelete;this.ondelete=(n=this.props)=>{this.ONRESIZE&&window.removeEventListener("resize",this.ONRESIZE),this.state.unsubscribeTrigger("props"),this.dispatchEvent(i),a(this,n)}}if(typeof this.onchanged=="function"&&(this.state.data.props=this.props,this.state.subscribeTrigger("props",this.onchanged)),this.renderonchanged){let a=this.renderonchanged;typeof this.renderonchanged=="number"&&this.unsubscribeTrigger(this.renderonchanged),typeof a=="string"&&(a=O(a)),typeof a=="function"?this.renderonchanged=this.state.subscribeTrigger("props",n=>{this.render(n),a(this,n)}):a!==!1&&(this.renderonchanged=this.state.subscribeTrigger("props",this.render))}}constructor(){super()}delete=()=>{this.remove(),typeof this.ondelete=="function"&&this.ondelete(this.props)};render=(t=this.props)=>{typeof this.template=="function"?this.templateResult=this.template(this,t):this.templateResult=this.template,this.styles&&(this.templateResult=`<style>${this.styles}</style>${this.templateResult}`);let e=document.createElement("template");typeof this.templateResult=="string"?e.innerHTML=this.templateResult:this.templateResult instanceof HTMLElement&&(this.templateResult.parentNode&&this.templateResult.parentNode.removeChild(this.templateResult),e.appendChild(this.templateResult));let s=e.content;if(this.FRAGMENT&&(this.useShadow?(this.STYLE&&this.shadowRoot.removeChild(this.STYLE),this.shadowRoot.removeChild(this.FRAGMENT)):this.removeChild(this.FRAGMENT)),this.useShadow){if(this.attachedShadow||(this.attachShadow({mode:"open"}).innerHTML="<slot></slot>",this.attachedShadow=!0),this.styles){let r=document.createElement("style");r.textContent=this.styles,this.shadowRoot.prepend(r),this.STYLE=r}this.shadowRoot.prepend(s),this.FRAGMENT=this.shadowRoot.childNodes[0]}else this.prepend(s),this.FRAGMENT=this.childNodes[0];let i=new CustomEvent("rendered",{detail:{props:this.props,self:this}});this.dispatchEvent(i),this.oncreate&&this.oncreate(this,t)};state={pushToState:{},data:{},triggers:{},setState(t){if(Object.assign(this.pushToState,t),Object.keys(this.triggers).length>0)for(let e of Object.getOwnPropertyNames(this.triggers))this.pushToState[e]&&(this.data[e]=this.pushToState[e],delete this.pushToState[e],this.triggers[e].forEach(s=>{s.onchanged(this.data[e])}));return this.pushToState},subscribeTrigger(t,e=s=>{}){if(t){this.triggers[t]||(this.triggers[t]=[]);let s=this.triggers[t].length;return this.triggers[t].push({idx:s,onchanged:e}),this.triggers[t].length-1}else return},unsubscribeTrigger(t,e){let s,i=this.triggers[t];if(i)if(!e)delete this.triggers[t];else return i.find(a=>{if(a.idx===e)return!0})&&i.splice(s,1),!0},subscribeTriggerOnce(t=void 0,e=s=>{}){let s,i=r=>{e(r),this.unsubscribeTrigger(t,s)};s=this.subscribeTrigger(t,i)}};get props(){return this.props}set props(t={}){this.setAttribute("props",t)}get template(){return this.template}set template(t){this.setAttribute("template",t)}get render(){return this.render}get delete(){return this.delete}get state(){return this.state}get onchanged(){return this.onchanged}set onchanged(t){this.setAttribute("onchanged",t)}get styles(){return this.styles}set styles(t){this.styles=t,this.querySelector("style")?this.querySelector("style").innerHTML=t:this.render()}get renderonchanged(){return this.renderonchanged}set renderonchanged(t){this.setAttribute("renderonchanged",t)}get onresize(){return this.props}set onresize(t){this.setAttribute("onresize",t)}get ondelete(){return this.props}set ondelete(t){this.setAttribute("ondelete",t)}get oncreate(){return this.oncreate}set oncreate(t){this.setAttribute("oncreated",t)}};function x(c,t,e=null){try{e?t?window.customElements.define(t,c,{extends:e}):window.customElements.define(c.name.toLowerCase()+"-",c,{extends:e}):t?window.customElements.define(t,c):window.customElements.define(c.name.toLowerCase()+"-",c)}catch{}}function O(c){let t=a=>a.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),s=(a=>{let n=a.indexOf(")");return a.slice(0,a.indexOf("{",n)+1)})(c),i=t(c),r;try{if(s.includes("function")){let a=s.split("(")[1].split(")")[0];r=new Function(a,i)}else if(s.substring(0,6)===i.substring(0,6)){let a=s.split("(")[1].split(")")[0];r=new Function(a,i.substring(i.indexOf("{")+1,i.length-1))}else try{r=(0,eval)(s+i+"}")}catch{r=(0,eval)(c)}}catch{}return r}var w=class extends b{constructor(e={}){super(void 0,e.name?e.name:`service${Math.floor(Math.random()*1e14)}`,e.props);this.routes={};this.loadDefaultRoutes=!1;this.keepState=!0;this.firstLoad=!0;this.init=e=>{e?e=Object.assign({},e):e={},e.customRoutes?Object.assign(e.customRoutes,this.customRoutes):e.customRoutes=this.customRoutes,e.customChildren?Object.assign(e.customChildren,this.customChildren):e.customChildren=this.customChildren,Array.isArray(e.routes)?e.routes.forEach(s=>{this.load(s,e.includeClassName,e.routeFormat,e.customRoutes,e.customChildren)}):(e.routes||(Object.keys(this.routes).length>0||this.loadDefaultRoutes)&&this.firstLoad)&&this.load(e.routes,e.includeClassName,e.routeFormat,e.customRoutes,e.customChildren)};this.load=(e,s=!0,i=".",r,a)=>{if(!e&&!this.loadDefaultRoutes&&(Object.keys(this.routes).length>0||this.firstLoad))return;this.firstLoad&&(this.firstLoad=!1),r?r=Object.assign(this.customRoutes,r):r=this.customRoutes,a&&(a=Object.assign(this.customChildren,a));let n,o={};if(e){if(!(e instanceof b)&&e?.name)if(e.module){let h=e;e={},Object.getOwnPropertyNames(e.module).forEach(f=>{s?e[h.name+i+f]=e.module[f]:e[f]=e.module[f]})}else typeof e=="function"&&(n=new e({loadDefaultRoutes:this.loadDefaultRoutes}),n.load(),e=n.routes);else if(e instanceof b||e.source instanceof b){n=e,e={};let h;s&&(h=n.name,h||(h=n.tag,n.name=h),h||(h=`graph${Math.floor(Math.random()*1e15)}`,n.name=h,n.tag=h)),n.customRoutes&&!this.customRoutes?this.customRoutes=n.customRoutes:n.customRoutes&&this.customRoutes&&Object.assign(this.customRoutes,n.customRoutes),n.customChildren&&!this.customChildren?this.customChildren=n.customChildren:n.customChildren&&this.customChildren&&Object.assign(this.customChildren,n.customChildren),n.nodes.forEach(f=>{e[f.tag]=f;let d={},p=(u,y)=>{if((!d[u.tag]||y&&s&&!d[y?.tag+i+u.tag])&&(y?d[y.tag+i+u.tag]=!0:d[u.tag]=!0,u instanceof b||u.source instanceof b)){if(s){let m=u.name;m||(m=u.tag,u.name=m),m||(m=`graph${Math.floor(Math.random()*1e15)}`,u.name=m,u.tag=m)}u.nodes.forEach(m=>{s&&!e[u.tag+i+m.tag]?e[u.tag+i+m.tag]=m:e[m.tag]||(e[m.tag]=m),p(m,u)})}};p(f)})}else if(typeof e=="object"){let h=e.constructor.name;if(h==="Object"&&(h=Object.prototype.toString.call(e),h&&(h=h.split(" ")[1]),h&&(h=h.split("]")[0])),h&&h!=="Object"){let f=e;e={},Object.getOwnPropertyNames(f).forEach(d=>{s?e[h+i+d]=f[d]:e[d]=f[d]})}}if(n instanceof b&&n.name&&s){e=Object.assign({},e);for(let h in e){let f=e[h];delete e[h],e[n.name+i+h]=f}}}if(this.loadDefaultRoutes){let h=Object.assign({},this.defaultRoutes);e?(Object.assign(h,this.routes),e=Object.assign(h,e)):e=Object.assign(h,this.routes),this.loadDefaultRoutes=!1}e||(e=this.routes);let l=0;for(let h in e){l++;let f=(d,p)=>{if(typeof d=="object"&&(d.tag||(d.tag=p),typeof d?.children=="object")){e:for(let u in d.children)if(l++,typeof d.children[u]=="object"){let y=d.children[u];if(y.tag&&o[y.tag])continue;if(a){for(let E in a)if(y=a[E](y,u,d,e,o),!y)continue e}y.id&&!y.tag&&(y.tag=y.id);let m;if(y.tag)if(o[y.tag]){let E=`${y.tag}${l}`;o[E]=y,y.tag=E,f(o[E],u),m=E}else o[y.tag]=y,f(o[y.tag],u),m=y.tag;else if(o[u]){let E=`${u}${l}`;o[E]=y,y.tag=E,f(o[E],u),m=E}else o[u]=y,f(o[u],u),m=u;n?.name&&s?(o[n.name+i+m]=y,delete o[m]):o[m]=y}}};o[h]=e[h],f(e[h],h)}e:for(let h in o)if(typeof o[h]=="object"){let f=o[h];if(typeof f=="object"){if(r){for(let d in r)if(f=r[d](f,h,o),!f)continue e}f.get&&f.get,f.post,f.delete,f.put,f.head,f.patch,f.options,f.connect,f.trace,f.post&&!f.operator?o[h].operator=f.post:!f.operator&&typeof f.get=="function"&&(o[h].operator=f.get)}}for(let h in e)typeof e[h]=="object"?this.routes[h]?typeof this.routes[h]=="object"?Object.assign(this.routes[h],e[h]):this.routes[h]=e[h]:this.routes[h]=e[h]:this.routes[h]?typeof this.routes[h]=="object"?Object.assign(this.routes[h],e[h]):this.routes[h]=e[h]:this.routes[h]=e[h];if(n)for(let h in this.routes)this.routes[h]instanceof g&&(this.nodes.set(h,this.routes[h]),this.nNodes=this.nodes.size);else this.setTree(this.routes);for(let h in this.routes)this.routes[h]?.aliases&&this.routes[h].aliases.forEach(d=>{n?.name&&s?e[n.name+i+d]=this.routes[h]:e[d]=this.routes[h]});return this.routes};this.unload=(e=this.routes)=>{if(!e)return;let s;!(e instanceof w)&&typeof e=="function"?(s=new w,e=s.routes):e instanceof w&&(e=e.routes);for(let i in e)delete this.routes[i],this.nodes.get(i)&&this.remove(i);return this.routes};this.handleMethod=(e,s,i)=>{let r=s.toLowerCase();return r==="get"&&this.routes[e]?.get?.transform instanceof Function?Array.isArray(i)?this.routes[e].get.transform(...i):this.routes[e].get.transform(i):this.routes[e]?.[r]?this.routes[e][r]instanceof Function?this.routes[e][r](i):(i&&(this.routes[e][r]=i),this.routes[e][r]):this.handleServiceMessage({route:e,args:i,method:s})};this.transmit=(...e)=>typeof e[0]=="object"?e[0].method?this.handleMethod(e[0].route,e[0].method,e[0].args):e[0].route?this.handleServiceMessage(e[0]):e[0].node?this.handleGraphNodeCall(e[0].node,e[0].args):(this.keepState&&(e[0].route&&this.setState({[e[0].route]:e[0].args}),e[0].node&&this.setState({[e[0].node]:e[0].args})),e):e;this.receive=(...e)=>{if(e[0]&&typeof e[0]=="string"){let s=e[0].substring(0,8);(s.includes("{")||s.includes("["))&&(s.includes("\\")&&(e[0]=e[0].replace(/\\/g,"")),e[0][0]==='"'&&(e[0]=e[0].substring(1,e[0].length-1)),e[0]=JSON.parse(e[0]))}return typeof e[0]=="object"?e[0].method?this.handleMethod(e[0].route,e[0].method,e[0].args):e[0].route?this.handleServiceMessage(e[0]):e[0].node?this.handleGraphNodeCall(e[0].node,e[0].args):(this.keepState&&(e[0].route&&this.setState({[e[0].route]:e[0].args}),e[0].node&&this.setState({[e[0].node]:e[0].args})),e):e};this.pipe=(e,s,i,r,a)=>{if(e instanceof g)return a?e.subscribe(n=>{let o=a(n);o!==void 0?this.transmit({route:s,args:o,method:r}):this.transmit({route:s,args:n,method:r},i)}):this.subscribe(e,n=>{this.transmit({route:s,args:n,method:r},i)});if(typeof e=="string")return this.subscribe(e,n=>{this.transmit({route:s,args:n,method:r},i)})};this.pipeOnce=(e,s,i,r,a)=>{if(e instanceof g)return a?e.state.subscribeTriggerOnce(e.tag,n=>{let o=a(n);o!==void 0?this.transmit({route:s,args:o,method:r}):this.transmit({route:s,args:n,method:r},i)}):this.state.subscribeTriggerOnce(e.tag,n=>{this.transmit({route:s,args:n,method:r},i)});if(typeof e=="string")return this.state.subscribeTriggerOnce(e,n=>{this.transmit({route:s,args:n,method:r},i)})};this.terminate=(...e)=>{this.nodes.forEach(s=>{s.stopNode()})};this.recursivelyAssign=(e,s)=>{for(let i in s)typeof s[i]=="object"?typeof e[i]=="object"?this.recursivelyAssign(e[i],s[i]):e[i]=this.recursivelyAssign({},s[i]):e[i]=s[i];return e};this.defaultRoutes={"/":{get:()=>this.print(),aliases:[""]},ping:()=>(console.log("ping"),"pong"),echo:(...e)=>(this.transmit(...e),e),assign:e=>typeof e=="object"?(Object.assign(this,e),!0):!1,recursivelyAssign:e=>typeof e=="object"?(this.recursivelyAssign(this,e),!0):!1,log:{post:(...e)=>{console.log("Log: ",...e)},aliases:["info"]},error:e=>{let s=new Error(e);return console.error(e),s},state:e=>e?this.state.data[e]:this.state.data,printState:e=>e?C(this.state.data[e]):C(this.state.data),spliceTypedArray:this.spliceTypedArray,transmit:this.transmit,receive:this.receive,load:this.load,unload:this.unload,pipe:this.pipe,terminate:this.terminate,run:this.run,_run:this._run,subscribe:this.subscribe,subscribeNode:this.subscribeNode,unsubscribe:this.unsubscribe,stopNode:this.stopNode,get:this.get,add:this.add,remove:this.remove,setTree:this.setTree,setState:this.setState,print:this.print,reconstruct:this.reconstruct,handleMethod:this.handleMethod,handleServiceMessage:this.handleServiceMessage,handleGraphNodeCall:this.handleGraphNodeCall};e.name?this.name=e.name:e.name=this.tag,"loadDefaultRoutes"in e&&(this.loadDefaultRoutes=e.loadDefaultRoutes,this.routes=Object.assign(this.defaultRoutes,this.routes)),(e||Object.keys(this.routes).length>0)&&this.init(e)}handleServiceMessage(e){let s;return typeof e=="object"&&(e.route?s=e.route:e.node&&(s=e.node)),s?Array.isArray(e.args)?this.run(s,...e.args):this.run(s,e.args):e}handleGraphNodeCall(e,s){if(!e)return s;if(s?.args)this.handleServiceMessage(s);else return Array.isArray(s)?this.run(e,...s):this.run(e,s)}isTypedArray(e){return ArrayBuffer.isView(e)&&Object.prototype.toString.call(e)!=="[object DataView]"}spliceTypedArray(e,s,i){let r=e.subarray(0,s),a;i&&(a=e.subarray(i+1));let n;return(r.length>0||a?.length>0)&&(n=new e.constructor(r.length+a.length)),r.length>0&&n.set(r),a&&a.length>0&&n.set(a,r.length),n}};var G=class extends w{constructor(e,s,i){super({props:e?.props,name:e?.name?e.name:`dom${Math.floor(Math.random()*1e15)}`});this.loadDefaultRoutes=!1;this.keepState=!0;this.parentNode=document.body;this.interpreters={md:(e,s)=>{typeof markdownit>"u"&&document.head.insertAdjacentHTML("beforeend",`
                    <script src='https://unpkg.com/markdown-it@latest/dist/markdown-it.min.js'><\/script>`);let r=globalThis.markdownit().render(e);s.template=r},jsx:(e,s)=>{s.parentNode||(s.parentNode=this.parentNode),typeof s.parentNode=="string"&&(s.parentNode=document.getElementById(s.parentNode)),typeof ReactDOM>"u"&&document.head.insertAdjacentHTML("beforeend",`
                    <script src='https://unpkg.com/react@latest/umd/react.production.min.js'><\/script>
                    <script src='https://unpkg.com/react-dom@latest/umd/react-dom.production.min.js'><\/script>`),s.template="";let i=s.onrender;s.onrender=(r,a)=>{let n=ReactDOM.createPortal(e,s.id);i(r,a)}}};this.customRoutes={dom:(e,s,i)=>(e.template?(e.tag||(e.tag=s),this.addComponent(e,e.generateChildElementNodes)):e.context?(e.tag||(e.tag=s),this.addCanvasComponent(e)):(e.tagName||e.element)&&(e.tag||(e.tag=s),this.addElement(e,e.generateChildElementNodes)),e)};this.customChildren={dom:(e,s,i,r,a)=>((i.tag||i.id)&&(i.template||i.context||i.tagName||i.element)&&(e.template||e.context||e.tagName||e.element)&&!e.parentNode&&(i.tag&&(e.parentNode=i.tag),i.id&&(e.parentNode=i.id)),e)};this.elements={};this.components={};this.templates={};this.resolveNode=(e,s)=>{let i;this.nodes.get(s.id)?.element?.parentNode?.id===s.parentNode||this.nodes.get(s.id)?.parentNode===s.parentNode?(i=this.nodes.get(s.id),i.element=e):i=new g(s,s.parentNode?this.nodes.get(s.parentNode):this.parentNode,this);for(let r in s)typeof s[r]=="function"&&s[r].bind(i);return i};this.addElement=(e,s=!1)=>{let i=this.createElement(e),r=e.onrender;e.element||(e.element=i),e.operator||(e.operator=function(o){if(typeof o=="object")for(let l in o)this.element&&(typeof this.element[l]=="function"&&typeof o[l]!="function"?Array.isArray(o[l])?this.element[l](...o[l]):this.element[l](o[l]):l==="style"?Object.assign(this.element[l],o[l]):this.element[l]=o[l]);return o});let a=this.resolveNode(i,e);i.node=a;let n=Array.from(i.querySelectorAll("*"));if(s&&(n=n.map((o,l)=>this.addElement({element:o}))),this.elements[e.id]={element:i,node:a,parentNode:e.parentNode,divs:n},a.ondelete||(a.ondelete=o=>{i.remove(),e.onremove&&e.onremove(i,this.elements[e.id])}),e.onresize){let o=e.onresize;e.onresize=l=>{o(l,i,this.elements[e.id])},window.addEventListener("resize",e.onresize)}return i.parentNode||setTimeout(()=>{typeof e.parentNode=="string"&&(e.parentNode=document.getElementById(e.parentNode)),typeof e.parentNode=="object"&&e.parentNode.appendChild(i),r&&r(i,this.elements[e.id])},.01),this.elements[e.id]};this.createElement=e=>{let s;if(e.element?typeof e.element=="string"?(s=document.querySelector(e.element),s||(s=document.getElementById(e.element))):s=e.element:e.tagName?s=document.createElement(e.tagName):e.id&&document.getElementById(e.id)&&(s=document.getElementById(e.id)),!!s)return this.updateOptions(e,s),s};this.updateOptions=(e,s)=>(!e.id&&e.tag&&(e.id=e.tag),!e.tag&&e.id&&(e.tag=e.id),e.id||(e.id=`${e.tagName??"element"}${Math.floor(Math.random()*1e15)}`),typeof e.parentNode=="string"&&document.getElementById(e.parentNode)&&(e.parentNode=document.getElementById(e.parentNode)),e.parentNode||(this.parentNode||(this.parentNode=document.body),e.parentNode=this.parentNode),s.id=e.id,e.style&&Object.assign(s.style,e.style),e.attributes&&Object.assign(s,e.attributes),e);this.addComponent=(e,s=!0)=>{if(e.onrender){let l=e.onrender;e.onrender=h=>{l(h,e)}}if(e.onresize){let l=e.onresize;e.onresize=h=>{l(h,e)}}if(e.onremove){let l=e.onremove;e.onremove=h=>{l(h,e)}}if(typeof e.renderonchanged=="function"){let l=e.renderonchanged;e.renderonchanged=h=>{l(h,e)}}e.interpreter&&e.interpreter!=="wc"&&this.interpreters[e.interpreter](e.template,e);class i extends A{constructor(){super(...arguments);this.props=e.props;this.styles=e.styles;this.useShadow=e.useShadow;this.template=e.template;this.oncreate=e.onrender;this.onresize=e.onresize;this.ondelete=e.onremove;this.renderonchanged=e.renderonchanged}}e.tagName||(e.tagName=`custom-element${Math.random()*1e15}`),i.addElement(e.tagName);let r=document.createElement(e.tagName),a=this.updateOptions(e,r);this.templates[a.id]=a;let n=Array.from(r.querySelectorAll("*"));s&&(n=n.map(l=>this.addElement({element:l}))),e.element||(e.element=r),e.operator||(e.operator=function(h){if(typeof h=="object")for(let f in h)this.element&&(typeof this.element[f]=="function"&&typeof h[f]!="function"?Array.isArray(h[f])?this.element[f](...h[f]):this.element[f](h[f]):f==="style"?Object.assign(this.element[f],h[f]):this.element[f]=h[f]);return h});let o=this.resolveNode(r,e);return o.ondelete||(o.ondelete=l=>{r.delete()}),r.node=o,this.components[a.id]={element:r,class:i,node:o,divs:n,...a},r.parentNode||setTimeout(()=>{typeof e.parentNode=="string"&&(e.parentNode=document.getElementById(e.parentNode)),typeof e.parentNode=="object"&&e.parentNode.appendChild(r)},.01),this.components[a.id]};this.addCanvasComponent=e=>{if(e.canvas?e.template=e.canvas:(e.template="<canvas ",e.width&&(e.template+=`width="${e.width}"`),e.height&&(e.template+=`height="${e.height}"`),e.template+=" ></canvas>"),e.onrender){let h=e.onrender;e.onrender=f=>{h(f,e)}}if(e.onresize){let h=e.onresize;e.onresize=f=>{h(f,e)}}if(e.ondelete){let h=e.onremove;e.onremove=f=>{h(f,e)}}if(typeof e.renderonchanged=="function"){let h=e.renderonchanged;e.renderonchanged=f=>{h(f,e)}}class s extends A{constructor(){super(...arguments);this.props=e.props;this.styles=e.styles;this.template=e.template;this.oncreate=e.onrender;this.onresize=e.onresize;this.ondelete=e.onremove;this.renderonchanged=e.renderonchanged}}e.tagName||(e.tagName=`custom-element${Math.random()*1e15}`),s.addElement(e.tagName);let i=document.createElement(e.tagName),r=this.updateOptions(e,i),a=()=>{this.components[r.id]?.animating&&(this.components[r.id].draw(this.components[r.id].element,this.components[r.id]),requestAnimationFrame(a))};this.templates[r.id]=r,e.element||(e.element=i),e.operator||(e.operator=function(f){if(typeof f=="object")for(let d in f)this.element&&(typeof this.element[d]=="function"&&typeof f[d]!="function"?Array.isArray(f[d])?this.element[d](...f[d]):this.element[d](f[d]):d==="style"?Object.assign(this.element[d],f[d]):this.element[d]=f[d]);return f});let n=this.resolveNode(i,e);i.node=n,n.ondelete||(n.ondelete=h=>{i.delete()});let o=i.querySelector("canvas");r.style&&Object.assign(o.style,r.style);let l;return typeof r.context=="object"?l=e.context:typeof r.context=="string"&&(l=o.getContext(r.context)),this.components[r.id]={element:i,class:s,template:r.template,canvas:o,node:n,...r},this.components[r.id].context=l,i.canvas=o,i.context=l,n.canvas=o,n.context=l,i.parentNode||setTimeout(()=>{typeof e.parentNode=="string"&&(e.parentNode=document.getElementById(e.parentNode)),typeof e.parentNode=="object"&&e.parentNode.appendChild(i)},.01),n.runAnimation(a),this.components[r.id]};this.terminate=e=>{if(typeof e=="object")e.animating&&(e.animating=!1),e.element&&(e=e.element);else if(typeof e=="string"&&this.components[e]){this.components[e].node.isAnimating&&this.components[e].node.stopNode(),this.components[e].divs&&this.components[e].divs.forEach(i=>this.terminate(i));let s=this.components[e].element;delete this.components[e],e=s}else if(typeof e=="string"&&this.elements[e]){this.elements[e].divs&&this.elements[e].divs.forEach(i=>this.terminate(i));let s=this.elements[e].element;this.elements[e].onresize&&window.removeEventListener("resize",this.elements[e].onresize),this.elements[e].ondelete&&this.elements[e].ondelete(s,this.elements[e]),delete this.elements[e],e=s}return e?(this.nodes.get(e.id)&&this.removeTree(e.id),e instanceof A?e.delete():e?.parentNode&&e.parentNode.removeChild(e),!0):!1};this.defaultRoutes={addElement:this.addElement,addComponent:this.addComponent,addCanvasComponent:this.addCanvasComponent,terminate:this.terminate};e?.parentNode&&(s=e.parentNode),typeof s=="string"&&(s=document.getElementById(s)),s instanceof HTMLElement&&(this.parentNode=s),i&&Object.assign(this.interpreters,i),this.init(e)}};var S=(c,t)=>{let e=t.arguments,s={};Array.from(e.entries()).forEach(([r],a)=>{s[r]={tag:r,operator:n=>{let o=e.get(r);return o.state=n,a===0?t.run():n}}});let i=t.operator.bind(t);return t.operator=(...r)=>{let a=[],n=0;return e.forEach((o,l)=>{let h=e.get(l),f=h.spread?r.slice(n):r[n],d=f!==void 0?f:o.state;h.state=d,h.spread||(d=[d]),a.push(...d),n++}),i(...a)},new b(s,c,t)};var D=/([^,]*)/g;function I(c){var t=c.toString();let e=t.indexOf("("),s=t.indexOf(")"),i=(l,h=0)=>{let f=h+l.indexOf("{");return f<s&&f>e?i(l.slice(f),h+f):f},r=i(t),a;if(r===-1||s<r?a=t.slice(t.indexOf("(")+1,t.indexOf(")")):a=t.match(/([a-zA-Z]\w*|\([a-zA-Z]\w*(,\s*[a-zA-Z]\w*)*\)) =>/)?.[1],!a)return;let n=a.match(D).filter(l=>!!l),o=new Map;return n.forEach(l=>{let[h,f]=l.split("=");h=h.trim(),h=h.replace(/\d+$/,"");let d=h.includes("...");h=h.replace("...","");try{h&&o.set(h,{state:f&&(0,eval)(`(${f})`),spread:d})}catch{o.set(h,{}),console.warn(`Argument ${h} could not be parsed for`,c.toString(),f)}}),o}var j=I;var L="process"in globalThis,v=class{#e;#t;#i;get initial(){return this.#e}get instance(){return this.#t}get graphscript(){return this.#i}set graphscript(t){this.#i=t}constructor(t,e={}){this.#e=t;do this.#e=this.initial.initial??this.initial;while(this.initial instanceof v);if(t.graph){let i={};for(let a in this.initial.graph.nodes){let n=this.initial.graph.nodes[a];i[a]=this.#s(a,n)}let r=this.initial.graph.edges;for(let a in r){let n=i[a];n.children||(n.children={});for(let o in r[a])n.children[o]=!0}this.graphscript=L?new Graph(i):new G({routes:i},e.parentNode);for(let a in this.initial.graph.nodes){let n=this.initial.graph.nodes[a];if(n instanceof v){let o=this.graphscript.nodes.get(a);o&&(n.graphscript=o)}else{let o=Object.assign({},Object.assign(e));this.initial.graph.nodes[a]=new v(n,Object.assign(o,{tag:a})),typeof e.onPlugin=="function"&&e.onPlugin(n.graph.nodes[a])}}}"default"in this.initial&&(this.graphscript=new g(this.#s(e.tag??"defaultESPluginTag",this.initial)));let s=this.graphscript?.tag;Object.defineProperty(this,"tag",{get:()=>this.graphscript?.tag,enumerable:!0})}#s=(t,e)=>{let s;e instanceof v&&(s=e.instance,e=e.initial);let i=j(e.default)??new Map;i.size===0&&i.set("default",{});let r=i.keys().next().value;if(e.arguments)for(let l in e.arguments){let h=i.get(l);h.state=e.arguments[l],r===l&&this.run()}let a={arguments:i,operator:e.default,tag:t};var n=Object.getOwnPropertyNames(e);let o=["arguments","default","tag","operator"];if(n.forEach(l=>{o.includes(l)||(a[l]=e[l])}),s)for(let l in s)o.includes(l)||(a[l]=s[l]);return this.#t=a,S(t,a)};run=async(...t)=>await this.graphscript.run(...t)},ne=v;})();
//# sourceMappingURL=index.js.map
